# Тестовое для СПБ ТСБ
* REST-сервис для проведения операций со счетом (1 счет, 1 клиент, валюта RUR)
* 2 вида по купок - онлайн и в магазине
* за покупки в магазине автоматически начисляется кэшбек 10%
* за онлайн покупки до 20р начисляется 10%, 21-300 - 17%, более 300р - 30%
* реализовать эндпйонты для оплаты покупок, получения начисленного кэшбека, количества средста на счете
* реализовать статусную модель
* реализовать паттерн Состояние

# Реализация
* для простоты проверки выбрана БД h2, чтобы не устанавливать доп. зависимости
* REST-сервис реализован на Spring WEB
* все действия со счетом проходят в рамках транзакции
* покупка и зачисление бонуса происходят так же в рамках 1 транзакции
* статусная модель реализована для счета - он может быть активный или заблокированный
* для удаленного счета нет доступных операций
* для активных счетов доступны любые операции

# Покупка и зачисление бонусов
* счет состоит из 2 частей - наичисленные бонусы и обычный рублевый баланс
* при попытке оплаты средства сначала спишутся с обычного баланса
* если средств на обычном балансе не хватает, пытаемся списать остаток цены с балансового счета
* если средств не хватает даже с учетом баланса, возвращаем пользователю ошибку о неудчной покупке и нехватке средств

# Тестирование
* в папке test реализованы тесты для контроллера, создания и сохранения данных по счету
* основной тест-кейс из ТЗ лежит в [AccountServiceImplTest.java](src%2Ftest%2Fjava%2Fcom%2Fexample%2Fspb_br%2Fservice%2FAccountServiceImplTest.java) getAccountAfterPurchaseTest